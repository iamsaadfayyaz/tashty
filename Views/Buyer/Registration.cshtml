@{

	ViewBag.Title = "Tashty | Buyer Registration";
	Layout = "~/Views/Shared/_LayoutRegistration.cshtml";
	int id = (int)ViewData["profileID"];
}
<section>
	<div class="container top-spc">
        <div class="f1 stepstext">
            <div class="row">
                <fieldset class="m-t-lg">
                    <h2>Buyer Registration</h2>
                    <p>Tell us a bit about yourself. This information will appear on your public profile, so that potential buyers can get to know you better.</p>
                    <div class="border-bottom text-right m-b-lg" style="padding-bottom:5px;"><small><span class="text-danger">*</span>Mandatory fields</small></div>
                    <div class="row">

                        <div class="col-lg-10 wizardform">
                            <form id="frmbuyRegProfile" role="form" action="" method="post">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="f-name">Full Name</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control input-lg" maxlength="32" pattern="[A-Za-z]{1,32}" placeholder="First Name" name="txtFirstName" id="txtFirstName" required>
                                    </div>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control input-lg" maxlength="32" pattern="[A-Za-z]{1,32}" placeholder="Last Name" name="txtLastName" id="txtLastName" required>
                                    </div>
                                </div>

                                <div class="form-group m-b">
                                    <label class="col-sm-2 control-label">Title</label>
                                    <div class="col-sm-5">
                                        <select id="ddlTitle" class="form-control input-lg" required>
                                            <option value=""> select Title</option>
                                            @if (ViewBag.ListTitles != null)
                                            {
                                                for (int i = 0; i < ViewBag.ListTitles.Count; i++)
                                                {
                                                    string val = ViewBag.ListTitles[i].titleID.ToString();
                                                    string title = ViewBag.ListTitles[i].titleName.ToString();

                                                    <text>
                                                        <option value="@val">@title</option>  </text>
                                                }

                                            }
                                        </select>
                                    </div>
                                    <div class="col-sm-5">
                                        <select id="ddlGender" class="form-control input-lg" required>
                                            <option value=""> select Gender</option>
                                            @if (ViewBag.ListGenders != null)
                                            {
                                                for (int i = 0; i < ViewBag.ListGenders.Count; i++)
                                                {
                                                    string val = ViewBag.ListGenders[i].genderID.ToString();
                                                    string title = ViewBag.ListGenders[i].name.ToString();

                                                    <text>
                                                        <option value="@val">@title</option>  </text>
                                                }

                                            }
                                        </select>
                                    </div>
                                </div>


                                <div class="form-group m-b">
                                    <label class="col-sm-2 control-label" for="m-number">Phone Number</label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control input-lg" maxlength="12" pattern="\d*" required placeholder="Mobile Number" name="txtMobile" id="txtMobile">
                                    </div>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control input-lg" maxlength="12" pattern="\d*" placeholder="Phone Number" name="txtPhone" id="txtPhone">
                                    </div>
                                </div>
                                <div class="form-group m-b">
                                    <label class="col-sm-2 control-label">Profile Picture</label>
                                    <div class="col-lg-10">
                                        <input type="hidden" id="hdnPFFilename" />
                                        <img class="profile-photo img-circle" width="150" height="150" src="@Url.Content("~/Content/images/profile-default.jpg")" /><br />
                                        <div class="file-loading">
                                            <input id="fileProfilePhoto" type="file" style="margin-left:3%;" />

                                        </div>
                                        <div class="form-group col-lg-10"><small> maximum allowed upload size is 100 kb.</small></div>
                                    </div>
                                </div>
                                <input type="submit" style="display:none;" id="btnSubmitAllInfo" />
                            </form>
                            <form id="frmbuyRegAdd" role="form" action="">
                                <div class="form-group m-b">
                                    <label class="col-sm-2 control-label">Address Detail</label>
                                    <div class="col-sm-5">
                                        <input id="hdnAddressTypeID" type="hidden" />
                                        <select id="ddlAddressType" class="form-control input-lg" required>
                                            <option value=""> select Address Type</option>
                                            @if (ViewBag.ListAddressType != null)
                                            {
                                                for (int i = 0; i < ViewBag.ListAddressType.Count; i++)
                                                {
                                                    string val = ViewBag.ListAddressType[i].addressTypeID.ToString();
                                                    string title = ViewBag.ListAddressType[i].addressType.ToString();

                                                    <text>
                                                        <option value="@val">@title</option>  </text>
                                                }

                                            }
                                        </select>
                                    </div>

                                    <div class="col-sm-5">
                                        <input type="text" class="form-control input-lg" id="txtAddress" placeholder="Enter Address" required>
                                    </div>

                                    <div class="col-sm-2">&nbsp;</div>
                                    <div class="col-sm-5 m-t-sm">
                                        <input id="hdnCountryID" type="hidden" />
                                        <select id="ddlCountry" disabled class="form-control input-lg" required>
                                            <option value=""> select Country</option>
                                            @if (ViewBag.ListCountries != null)
                                            {
                                                for (int i = 0; i < ViewBag.ListCountries.Count; i++)
                                                {
                                                    string val = ViewBag.ListCountries[i].countryID.ToString();
                                                    string title = ViewBag.ListCountries[i].country.ToString();

                                                    <text>
                                                        <option value="@val">@title</option>  </text>
                                                }

                                            }
                                        </select>
                                    </div>
                                    <div class="col-sm-5 m-t-sm">
                                        <input id="hdnCityID" type="hidden" />
                                        <select id="ddlCity" class="form-control input-lg" required>
                                            <option value=""> select city</option>
                                        </select>
                                    </div>

                                    <div class="col-sm-2">&nbsp;</div>
                                    <div class="col-sm-5 m-t-sm">
                                        <input type="text" class="form-control input-lg" id="txtPostalCode" placeholder="Add Postal Code" pattern="[a-zA-Z0-9]{1,20}" required>
                                    </div>

                                    <div class="col-sm-5 m-t-sm">
                                        <div class="form-group col-lg-4 m-t-md">
                                            <button type="submit" id="btnAddAddress" class="btn btn-success">Add</button>
                                        </div>
                                    </div>
                                    <div class="col-sm-2">&nbsp;</div>
                                    <div class="col-sm-10 m-t-sm">
                                        <div class="col-lg-12 m-t hbuilt">
                                            <h5>Address History</h5>
                                            <hr />
                                            <div class="Address-History">
                                                <div class="table-responsive">
                                                    <table class="table" cellspacing="1" cellpadding="1">
                                                        <thead>
                                                            <tr>
                                                                <th>Address Type</th>
                                                                <th>Street Address</th>
                                                                <th>City</th>
                                                                <th>Country</th>
                                                                <th>PostCode</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tblBuyerAddress"><tr><td colspan='5'><center> No record found </center></td></tr></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </form>
                            <div class="f1-buttons">
                                <button type="button" id="btnSaveInfo" class="btn btn-success btn-lg">Save & Continue</button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
	</div>
</section>
<script>
    var loadedPhotoURL = "";
    var customPhotoValidationFailed = false;

    document.getElementById("btnSubmitAllInfo").addEventListener("click", function () {

        document.getElementById("frmbuyRegProfile").className = "submitted";

    });

    document.getElementById("btnAddAddress").addEventListener("click", function () {

        document.getElementById("frmbuyRegAdd").className = "submitted";

    });

	var readURL = function (input) {

		if (input.files && input.files[0]) {
			var reader = new FileReader();

			reader.onload = function (e) {
				//$('.profile-photo').attr('src', e.target.result);
                loadedPhotoURL = e.target.result;
			}

			reader.readAsDataURL(input.files[0]);
		}
	}


	$("#fileProfilePhoto").on('change', function () {
		readURL(this);
	});

	var ListCities = [];
		reg.setProfileID(@ViewBag.profileID);


    $(document).ready(function () {
        reg.GetBuyerInformation('@id');

		ListCities = @Html.Raw(Json.Encode(ViewBag.ListCities));
        $("#hdnCountryID").val(@ViewBag.CountryID);
        _setSelect("ddlCountry", @ViewBag.CountryID);
        populateCities(@ViewBag.CountryID, ListCities, 'ddlCity');

		$('#ddlCity').on('change', function () {
			$("#hdnCityID").val(this.value);
		});

		$('#ddlCountry').on('change', function () {
			$("#hdnCountryID").val(this.value);
			populateCities(this.value, ListCities,'ddlCity');
		});

		$('#ddlAddressType').on('change', function () {
			$("#hdnAddressTypeID").val(this.value);
		});

        $("#frmbuyRegProfile").submit(function (e) {
            //e.preventDefault();
            ;
            reg.SaveBuyerInfo(true,@ViewBag.CountryID);
        });

		$('#btnSaveInfo').on('click', function () {
            $('#btnSubmitAllInfo').trigger("click");

		});


		$("#fileProfilePhoto").fileinput({
			theme: 'fa',
			uploadUrl: baseURL + 'Buyer/UploadProfilePic',
			dropZoneEnabled:false,
			browseClass: "upload-button btn btn-primary",
			showPreview: false,
			overwriteInitial: false,
			showCaption: false,
			showRemove: false,
			showCancel: false,
			showUpload: false,
			browseLabel: "Upload Picture",
			//maxFileSize: 2000,
			allowedFileExtensions: ['jpg', 'png', 'gif'],
			maxFilesNum: 1,
			layoutTemplates: { progress: '' },
			//minFileCount: 1,
            maxFileSize: 100,
            msgSizeTooLarge: 'Profile photo "{name}" (<b>{customSize}</b>) exceeds maximum allowed upload size of <b>{customMaxSize}</b>. Please retry your upload!',
			uploadAsync: true,
					slugCallback: function (filename) {

						return filename.replace('(', '_').replace(']', '_');
					},
					uploadExtraData: function () {
						return {
							FolderID: String("1")
						};
					}
			});

		});

    $('#fileProfilePhoto').on('fileuploaded', function (event, data, previewId, index) {
        $('.profile-photo').attr('src', loadedPhotoURL);
        _set("hdnPFFilename", data.response);
        customPhotoValidationFailed = false;
    });
    $('#fileProfilePhoto').on('fileuploaderror', function (event, data, msg) {
        customPhotoValidationFailed = true;
        var size = data.files[0].size,
            maxFileSize = $(this).data().fileinput.maxFileSize,
            formatSize = (s) => {
                i = Math.floor(Math.log(s) / Math.log(100));
                sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
                out = (s / Math.pow(100, i)).toFixed(2) * 1 + ' ' + sizes[i];
                return out;
            };

        msg = msg.replace('{customSize}', formatSize(size));
        msg = msg.replace('{customMaxSize}', formatSize(maxFileSize * 100 /* Convert KB to Bytes */));
        toastr.error(msg);
    });
    $('#fileProfilePhoto').on('fileselect', function (event, numFiles, label) {

        if (!customPhotoValidationFailed) {
            $("#fileProfilePhoto").fileinput("upload");
        }
        customPhotoValidationFailed = false;
    });



    $("#frmbuyRegAdd").submit(function (e) {
            //e.preventDefault();
            ;
           reg.AddAddressToList();
        });


</script>
<script>

var readURL = function(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('.profile-photo').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }


    $(".file-upload").on('change', function(){
        readURL(this);
    });

    $(".upload-button").on('click', function() {
       $(".file-upload").click();
    });

	$.uploadPreview({
    input_field: ".image-upload",
    preview_box: ".image-preview",
    label_field: ".image-label"
  });


</script>
<script>
    $(document).ready(function () {
     @*reg.GetBuyerInformation('@id');*@
        // Page scrolling feature
        $('a.page-scroll').bind('click', function(event) {
            var link = $(this);
            $('html, body').stop().animate({
                scrollTop: $(link.attr('href')).offset().top - 50
            }, 500);
            event.preventDefault();
        });

        $('body').scrollspy({
            target: '.navbar-fixed-top',
            offset: 80
        });
$('.carousel').carousel({
  interval: 5000,
  pause: false
})



    });
</script>
<script>
    $(document).ready(function(){

      $(window).scroll(function() { // check if scroll event happened
        if ($(document).scrollTop() > 100) { // check if user scrolled more than 50 from top of the browser window

          $(".navbar-fixed-top").css("background-color", "#fcfcfc"); // if yes, then change the color of class "navbar-fixed-top" to white (#f8f8f8)
          $('.logo').addClass('small-logo2');
		} else {
          $(".navbar-fixed-top").css("background-color", "#fcfcfc"); // if not, change it back to transparent
          $('.logo').removeClass('small-logo2');
		}
      });
    });
</script>